<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Table Editor</title>
    <script src="editor.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
        }

        input[type="number"] {
            width: 50px;
        }

        #wrapper {
            display: flex;
            height: 100%;
            padding: 10px;
        }

        #control {
            width: 500px;
            flex-shrink: 0;
            height: 100%;
            overflow-y: auto;
        }

        #preview {
            flex-grow: 1;
            height: 100%;
            overflow: auto;
        }

        .mt20 {
            margin-top: 20px;
        }

        .mt10 {
            margin-top: 10px;
        }
    </style>
</head>
<body>
<div id="wrapper">
    <div id="control">
        <h2>生成表格</h2>
        <div class="mt10">
            <input id="table-row" type="number" value="2" placeholder="行数">
            <span>行</span>
            <input id="table-column" type="number" value="3" placeholder="列数">
            <span>列</span>
            <button type="button" id="generate-table">生成表格</button>
        </div>
        <h2 class="mt20">行操作</h2>
        <div class="mt10">
            <span>在第</span>
            <input id="add-row-num" type="number" value="1">
            <span>行</span>
            <input id="add-row-above" type="radio" name="addRowPos" value="0" checked="checked">
            <label for="add-row-above">上面</label>
            <input id="add-row-below" type="radio" name="addRowPos" value="1">
            <label for="add-row-below">下面</label>
            <button type="button" id="add-row">新增一行</button>
        </div>
        <div class="mt10">
            <span>删除第</span>
            <input id="del-row-num" type="number" value="1">
            <span>行</span>
            <button type="button" id="del-row">删除</button>
        </div>
        <h2 class="mt20">列操作</h2>
        <div class="mt10">
            <span>在第</span>
            <input id="add-col-num" type="number" value="1">
            <span>列</span>
            <input id="add-col-left" type="radio" name="addColPos" value="0" checked="checked">
            <label for="add-col-left">左边</label>
            <input id="add-col-right" type="radio" name="addColPos" value="1">
            <label for="add-col-right">右边</label>
            <button type="button" id="add-col">新增一列</button>
        </div>
        <div class="mt10">
            <span>删除第</span>
            <input id="del-col-num" type="number" value="1">
            <span>列</span>
            <button type="button" id="del-col">删除</button>
        </div>
        <h2 class="mt20">单元格操作</h2>
        <div class="mt10">
            <span>行：</span>
            <input type="number" id="merge-1" value="0">
            <span> ~ </span>
            <input type="number" id="merge-2" value="0">
            <span>列：</span>
            <input type="number" id="merge-3" value="0">
            <span> ~ </span>
            <input type="number" id="merge-4" value="1">
            <button type="button" id="merge">合并单元格</button>
        </div>
        <div class="mt10">
            <span>切分</span>
            <input type="number" id="split-1" value="0">
            <input type="number" id="split-2" value="0">
            <span>为</span>
            <input type="number" id="split-3" value="2">
            <span>行</span>
            <input type="number" id="split-4" value="2">
            <span>列</span>
            <button type="button" id="split">切分单元格</button>
        </div>
        <h2 class="mt20">命令历史</h2>
        <div class="mt10">
            <button type="button" id="undo">撤销</button>
            <button type="button" id="redo">重做</button>
        </div>
    </div>
    <div id="preview"></div>
</div>
<script>
var tab;
(function () {
  function getElementById(id) {
    return document.getElementById(id);
  }
  getElementById('generate-table').addEventListener('click', function () {
    var rows = +getElementById('table-row').value;
    var columns = +getElementById('table-column').value;
    var data = [];
    var colWidth = 100;
    for (var i = 0; i < rows; i++) {
      for (var j = 0; j < columns; j++) {
        data.push({
          row: [i, i],
          col: [j, j],
          content: '(' + i + ',' + i + '),(' + j + ',' + j + ')',
          width: 60
        });
      }
    }
    data = [{"col":[0,0],"row":[0,1],"width":77.59477124183006,"content":"Method","style":{}},{"col":[1,1],"row":[0,1],"width":27.88562091503268,"content":"2D","style":{}},{"col":[2,2],"row":[0,0],"width":104.87418300653594,"content":"SVT-P","style":{}},{"col":[3,3],"row":[0,0],"width":43.04084967320261,"content":"CUTE","style":{}},{"col":[4,4],"row":[0,0],"width":30.310457516339866,"content":"IC15","style":{}},{"col":[2,2],"row":[1,1],"width":104.87418300653594,"content":"50FullNone","style":{}},{"col":[3,3],"row":[1,1],"width":43.04084967320261,"content":"None","style":{}},{"col":[4,4],"row":[1,1],"width":30.310457516339866,"content":"None","style":{}},{"col":[0,0],"row":[2,2],"width":77.59477124183006,"content":"Shi et al. [38]Liu et al. [28]Yang et al. [51]Cheng et al. [7]Cheng et al. [8]Liu et al. [29]Shi et al. [39]","style":{}},{"col":[1,1],"row":[2,2],"width":27.88562091503268,"content":"   ","style":{}},{"col":[2,2],"row":[2,2],"width":104.87418300653594,"content":"92.672.666.894.383.673.593.080.275.892.681.671.594.083.773.0––73.9––74.1","style":{}},{"col":[3,3],"row":[2,2],"width":43.04084967320261,"content":"54.9-69.363.976.862.573.3","style":{}},{"col":[4,4],"row":[2,2],"width":30.310457516339866,"content":"---66.268.2––","style":{}},{"col":[0,0],"row":[3,3],"width":77.59477124183006,"content":"ACE (2D)","style":{}},{"col":[1,1],"row":[3,3],"width":27.88562091503268,"content":" ","style":{}},{"col":[2,2],"row":[3,3],"width":104.87418300653594,"content":"94.987.870.1","style":{}},{"col":[3,3],"row":[3,3],"width":43.04084967320261,"content":"82.6","style":{}},{"col":[4,4],"row":[3,3],"width":30.310457516339866,"content":"68.9","style":{}}];
    window.tab = new window.te.TableEditor({
      elem: getElementById('preview'),
      data: data,
      colWidth: 60,
      cellFocusedBg: 'red',
      borderColor: 'blue',
      // resizeable: false,
      debug: true
    });

    window.tab.addEventListener('cellfocus', function(e) {
      console.log('cellfocus', e);
    });

    window.tab.addEventListener('cellblur', function(e) {
      console.log('cellblur', e);
    });

    window.tab.addEventListener('mousemove', function (e) {
      // console.log('mousemove', e);
    });
  });

  window.onload = function () {
    getElementById('generate-table').click();
  };

  function debugPos() {
    var trs = window.tab.table.elem.querySelector('tbody').children;
    for (let i = 0; i < trs.length; i++) {
      var tds = trs[i].children;
      for (let j = 0; j < tds.length; j++) {
        var td = tds[j];
        var rowRange = td.td.getRowRange();
        var colRange = td.td.getColRange();
        var content = rowRange.join(', ') + '\n' + colRange.join(', ');
        tab.setCellContent(rowRange[0], colRange[0], content);
      }
    }
  }

  getElementById('add-row').addEventListener('click', function () {
    var n = +getElementById('add-row-num').value - 1;
    var above = +document.querySelector('[name="addRowPos"]:checked').value === 0;
    tab.addRow(n, above);
  });

  getElementById('del-row').addEventListener('click', function () {
    var n = +getElementById('del-row-num').value - 1;
    tab.delRow(n);
  });

  getElementById('add-col').addEventListener('click', function () {
    var n = +getElementById('add-col-num').value - 1;
    var left = +document.querySelector('[name="addColPos"]:checked').value === 0;
    tab.addColumn(n, left);
  });

  getElementById('del-col').addEventListener('click', function () {
    var n = +getElementById('del-col-num').value - 1;
    tab.delColumn(n);
  });

  getElementById('merge').addEventListener('click', function () {
    var row = [
      +getElementById('merge-1').value,
      +getElementById('merge-2').value
    ];
    var col = [
      +getElementById('merge-3').value,
      +getElementById('merge-4').value
    ];
    tab.mergeCells(row, col);
    debugPos();
  });

  getElementById('split').addEventListener('click', function () {
    var rowIdx = +getElementById('split-1').value;
    var colIdx = +getElementById('split-2').value;
    var rowCount = +getElementById('split-3').value;
    var colCount = +getElementById('split-4').value;
    tab.splitCell(rowIdx, colIdx, rowCount, colCount);
  });

  getElementById('undo').addEventListener('click', function () {
    tab.undo();
  });

  getElementById('redo').addEventListener('click', function () {
    tab.redo();
  });
})();
</script>
</body>
</html>
